import { OnInitialize } from 'overmind'

const onInitialize: OnInitialize = async ({ state, effects }, app) => {
  const port = await effects.storage.get<string>('currentPort')
  const runtimeHost = await effects.storage.get<string>('runtimeHost')

  if (port) {
    state.port = port
  }

  if (runtimeHost) {
    state.runtimeHost = runtimeHost
  }

  effects.connector.onMessage(app.actions.onMessage)
  effects.connector.connect(state.port)
}

export default onInitialize
